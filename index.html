<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Há»‡ Pháº£n Xáº¡ Chiáº¿n LÆ°á»£c CÃ¡ NhÃ¢n â€“ T-04 / T-05</title>
  <style>
/* === RESET CÆ  Báº¢N === */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: "Segoe UI", sans-serif;
}

body {
  background: #f8f9fa;
  color: #222;
  padding: 30px;
  line-height: 1.6;
    max-width: 960px;
  margin: 0 auto;
}

header {
  text-align: center;
  margin-bottom: 30px;
}

h1, h2, h3, h4 {
  margin-bottom: 10px;
  color: #2c3e50;
}

section {
  margin-top: 40px;
  padding: 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

button {
  background: #2e86de;
  color: white;
  border: none;
  padding: 8px 16px;
  margin-top: 10px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #1b4f72;
}

/* === SKILL CARD === */
.skill-card {
  border: 1px solid #dee2e6;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  background: #ffffff;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}

.skill-card h3 {
  font-size: 18px;
  color: #2c3e50;
  margin-bottom: 10px;
}

.skill-card h3 a {
  color: inherit;
  text-decoration: none;
}

.skill-section {
  margin-bottom: 6px;
  color: #333;
  font-size: 15px;
}

.skill-details {
  background: #f4f6f9;
  padding: 10px;
  border-radius: 8px;
  margin-top: 8px;
}

.skill-actions {
  margin-top: 10px;
}

.skill-actions button {
  margin-right: 8px;
}

/* === AUDIT BLOCK === */
.audit-block {
  margin-bottom: 25px;
}

.audit-block textarea,
.audit-block select,
.audit-block input[type="text"],
.audit-block input[type="date"] {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
}

.audit-block ul {
  margin-left: 20px;
  margin-top: 8px;
}

textarea {
  resize: vertical;
  min-height: 80px;
}

/* === TABLE (Combat Log) === */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

table th,
table td {
  border: 1px solid #dee2e6;
  padding: 10px;
  text-align: left;
}

table th {
  background-color: #f0f2f5;
  font-weight: bold;
  color: #2c3e50;
}

/* === DASHBOARD PLACEHOLDER === */
#dashboardContainer {
  min-height: 120px;
  background: #fefefe;
  border: 1px dashed #ccc;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
  color: #999;
  font-style: italic;
}

/* === POPUP HIDDEN === */
.hidden {
  display: none;
}

.chart-warning {
  display: none;
  font-weight: bold;
  padding: 8px;
  border-left: 4px solid #faad14;
  background: #fffbe6;
  color: #d48806;
  margin: 10px 0 20px;
}

/* === FORM GRID Sáº®P Xáº¾P Gá»ŒN GÃ€NG === */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 20px;
}

.full-width {
  grid-column: 1 / -1;
}

/* === INPUT, SELECT, TEXTAREA === */
input[type="text"],
select,
textarea {
  font-size: 13px;
  padding: 6px 8px;
  border-radius: 5px;
  border: 1px solid #ccc;
  width: 100%;
  box-sizing: border-box;
  background: #fff;
  color: #222;
}

label {
  font-size: 14px;
  font-weight: 500;
  color: #333;
  margin-bottom: 6px;
  display: block;
}

/* === BUTTON CHUNG NHáº¤T === */
button {
  padding: 8px 14px;
  border-radius: 5px;
  font-size: 14px;
  transition: background 0.2s ease-in-out;
}

/* === CÄ‚N CHá»ˆNH Báº¢NG CHá»ŒN FILE === */
input[type="file"] {
  font-size: 13px;
  margin-top: 6px;
}

/* === FIX CHIá»€U CAO & MARGIN CHO CÃC FORM === */
.audit-block,
.skill-form {
  margin-top: 20px;
  margin-bottom: 20px;
}

.skill-form textarea {
  min-height: 80px;
}

/* === DROPDOWN CÃ“ KHOáº¢NG CÃCH === */
select {
  margin-top: 4px;
}

.filter-section {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  margin-top: 10px;
}

.import-section {
  margin-bottom: 10px;
}

.export-tools {
  text-align: right;
  margin-top: 20px;
}

/* === RESPONSIVE (TÃ™Y CHá»ŒN Má» Rá»˜NG SAU) === */
@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
  .filter-section {
    flex-direction: column;
    align-items: stretch;
  }
}
#personaSkillCards .skill-card {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 8px 0;
  background: #f9f9f9;
  border-left: 5px solid #4b91e2;
}
#personaSelector {
  margin: 10px 0;
  padding: 5px;
}

/* === FLOWCHART CONTAINER === */
.graph-container {
  transform: scale(0.8); /* Äiá»u chá»‰nh tá»‰ lá»‡ tÃ¹y Ã½ (0.6â€“1.0) */
  transform-origin: top left;
  max-width: 100%;
  overflow: auto;
  margin-bottom: 30px;
}

/* Cho phÃ©p kÃ©o ngang náº¿u biá»ƒu Ä‘á»“ dÃ i */
.graph-scroll-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
  width: 100%;
  padding-bottom: 10px;
}

/* === LESSON GRID === */
.lesson-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 12px;
  margin-top: 20px;
}

.lesson-box {
  display: block;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  background: #fff;
  text-align: center;
}

.lesson-box:hover {
  background: #f0f0f0;
}

/* === BADGE LINKS === */
.badge {
  display: inline-block;
  padding: 2px 6px;
  margin: 0 2px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 12px;
  text-decoration: none;
  color: #333;
}

.badge:hover {
  background: #e6e6e6;
}

/* === CHART WRAPPERS === */
.chart-wrapper {
  max-width: 400px; /* giáº£m kÃ­ch thÆ°á»›c biá»ƒu Ä‘á»“ */
  margin: 0 auto 20px;
  text-align: center;
}

.chart-wrapper canvas {
  width: 100% !important;
  height: auto !important;
}

.enlarge-btn {
  margin-top: 6px;
}

.chart-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.chart-overlay.hidden {
  display: none;
}

.chart-overlay button {
  position: absolute;
  top: 10px;
  right: 10px;
}

.chart-overlay canvas {
  max-width: 90vw;
  max-height: 90vh;
}

</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
  <header>
    <h1>ğŸŒŒ Há»‡ Pháº£n Xáº¡ Chiáº¿n LÆ°á»£c CÃ¡ NhÃ¢n</h1>
    <p class="subtitle">Äiá»u phá»‘i ká»¹ nÄƒng â€“ báº£n thá»ƒ â€“ váº­n má»‡nh sá»‘ng</p>
  </header>

  <!-- MODULE: SKILL MANAGER -->
  <section>
    <h2>ğŸ“˜ Ká»¹ NÄƒng Chiáº¿n LÆ°á»£c CÃ¡ NhÃ¢n</h2>
<div class="import-section">
  <label for="importCSV">ğŸ“¥ Nháº­p CSV: </label>
  <input type="file" id="importCSV" accept=".csv">
</div>

<h3>â• ThÃªm ká»¹ nÄƒng má»›i</h3>
<form id="addSkillForm">
  <div class="form-grid">
    <div>
      <label for="name">TÃªn ká»¹ nÄƒng</label>
      <input type="text" id="name" required />
    </div>
    <div>
      <label for="phase">ğŸ Giai Ä‘oáº¡n chiáº¿n lÆ°á»£c</label>
      <select id="phase" required>
        <option value="">-- Chá»n giai Ä‘oáº¡n --</option>
        <option value="Tá»± lá»±c">Tá»± lá»±c</option>
        <option value="GÃ¢y áº£nh hÆ°á»Ÿng">GÃ¢y áº£nh hÆ°á»Ÿng</option>
        <option value="Äiá»u phá»‘i">Äiá»u phá»‘i</option>
      </select>
    </div>
    <div>
      <label for="role">ğŸ­ Vai trÃ² hÃ nh Ä‘á»™ng</label>
      <select id="role" required>
        <option value="">-- Chá»n role --</option>
        <option value="Quan sÃ¡t">Quan sÃ¡t</option>
        <option value="GÃ i má»“i">GÃ i má»“i</option>
        <option value="Pháº£n chiáº¿u">Pháº£n chiáº¿u</option>
        <option value="Dáº«n dá»¥">Dáº«n dá»¥</option>
        <option value="Káº¿t liá»…u">Káº¿t liá»…u</option>
        <option value="áº¨n thÃ¢n">áº¨n thÃ¢n</option>
      </select>
    </div>
    <div>
      <label for="core">NÄƒng lá»±c lÃµi</label>
      <input type="text" id="core" />
    </div>
    <div class="full-width">
      <label for="skillClusterSelect">ğŸ—‚ï¸ NhÃ³m trá»¥ ká»¹ nÄƒng</label>
      <select id="skillClusterSelect" multiple size="5"></select>
    </div>
    <div class="full-width">
      <button type="submit">â• ThÃªm</button>
    </div>
  </div>
</form>
    
<hr>

    <!-- Bá»™ lá»c ká»¹ nÄƒng theo trá»¥ K -->
    
      <label for="clusterFilter">Lá»c theo trá»¥ ká»¹ nÄƒng:</label>
      <select id="clusterFilter">
        <option value="">-- Táº¥t cáº£ --</option>
      </select>
    </div>
    
    <div class="filter-section">
  <select id="filterPhase"><option value="">ğŸ”„ ğŸ Giai Ä‘oáº¡n chiáº¿n lÆ°á»£c</option></select>
  <select id="filterRole"><option value="">ğŸ”„ ğŸ­ Vai trÃ² hÃ nh Ä‘á»™ng</option></select>
  <select id="filterCore"><option value="">ğŸ”„ ğŸ§  NÄƒng lá»±c lÃµi</option></select>
  <select id="filterCluster"><option value="">ğŸ”„ ğŸ—‚ï¸ NhÃ³m trá»¥ ká»¹ nÄƒng</option></select>
  <button onclick="clearAllFilters()">âŒ XÃ³a lá»c</button>
</div>

 <!-- MODULE: 24 LESSON FRAMES -->
  <section>
    <h2>ğŸ“š 24 Trá»¥ BÃ i Há»c</h2>
  </section>

  <div id="skillCardsContainer"></div>

    <!-- âœ… Biá»ƒu Ä‘á»“ phÃ¢n loáº¡i theo Persona -->
    <section id="chartSection">
      <h3>ğŸ“Š Biá»ƒu Ä‘á»“ ká»¹ nÄƒng theo Persona</h3>
<div class="chart-wrapper" data-canvas="personaChart">
        <canvas id="personaChart" height="200"></canvas>
        <button class="enlarge-btn" onclick="enlargeChart('personaChart')">ğŸ” PhÃ³ng to</button>
      </div>
<label for="personaSelector">ğŸ­ Chá»n Persona:</label>
<select id="personaSelector">
  <option value="">â€” Táº¥t cáº£ â€”</option>
  <option value="Sirene">Sirene</option>
  <option value="Strategic Shadow">Strategic Shadow</option>
  <option value="Void Jester">Void Jester</option>
  <option value="Strategic Ghost">Strategic Ghost</option>
  <option value="Omni Mind">Omni Mind</option>
  <option value="Dark Sirene">Dark Sirene</option>
  <option value="Core Operator">Core Operator</option>
</select>

<div id="personaSkillCards"></div>

    </section>

    <!-- âœ… ThÃªm 3 biá»ƒu Ä‘á»“ phÃ¢n tÃ­ch -->
    <section>
      <h3>ğŸ“Š ğŸ Giai Ä‘oáº¡n chiáº¿n lÆ°á»£c Analysis</h3>
 <div class="chart-wrapper" data-canvas="phaseChart">
        <canvas id="phaseChart" height="120"></canvas>
        <button class="enlarge-btn" onclick="enlargeChart('phaseChart')">ğŸ” PhÃ³ng to</button>
      </div>
      <div id="phaseWarning" class="chart-warning"></div>
    </section>

    <section>
      <h3>âš”ï¸ ğŸ­ Vai trÃ² hÃ nh Ä‘á»™ng Analysis</h3>
  <div class="chart-wrapper" data-canvas="roleChart">
        <canvas id="roleChart" height="180"></canvas>
        <button class="enlarge-btn" onclick="enlargeChart('roleChart')">ğŸ” PhÃ³ng to</button>
      </div>
      <div id="roleWarning" class="chart-warning"></div>    </section>

    <section>
      <h3>ğŸ§  NÄƒng lá»±c lÃµi Competency Analysis</h3>
      <div class="chart-wrapper" data-canvas="coreChart">
        <canvas id="coreChart" height="120"></canvas>
        <button class="enlarge-btn" onclick="enlargeChart('coreChart')">ğŸ” PhÃ³ng to</button>
      </div>
      <div id="coreWarning" class="chart-warning"></div>
    </section>
  </section>

  <!-- MODULE: DASHBOARD -->
  <section>
    <h2>ğŸ“Š Dashboard Pháº£n Xáº¡</h2>
   <div id="dashboardContainer" class="chart-wrapper" data-canvas="clusterChart">
      <canvas id="clusterChart" height="400"></canvas>
      <button class="enlarge-btn" onclick="enlargeChart('clusterChart')">ğŸ” PhÃ³ng to</button>
      <div id="clusterGapReport" style="margin-top: 20px;"></div>
    </div>
  </section>

  <!-- MODULE: COMBAT LOG -->
  <section>
    <h2>âš”ï¸ TÃ¬nh Huá»‘ng Thá»±c Chiáº¿n</h2>
    <button onclick="addUseCase()">+ Ghi chiáº¿n tráº­n</button>
    <table id="useCases">
      <thead>
        <tr>
          <th>NgÃ y</th>
          <th>Ká»¹ nÄƒng dÃ¹ng</th>
          <th>TÃ¬nh huá»‘ng</th>
          <th>Pháº£n á»©ng</th>
          <th>Káº¿t quáº£</th>
          <th>BÃ i há»c</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- MODULE: STRATEGIC AUDIT STATION -->
  <section>
    <h2>ğŸ§  Tráº¡m Audit Chiáº¿n LÆ°á»£c â€“ Äiá»u Phá»‘i & Lá»‡ch Trá»¥c</h2>
    <label for="auditDate">NgÃ y kiá»ƒm tra:</label>
    <input type="date" id="auditDate" onchange="loadAuditEntry()" />

    <div id="auditEntry">
      <!-- 1. Sinh há»c cÃ¡ nhÃ¢n -->
      <div class="audit-block">
        <h4>1. Sinh khÃ­ hiá»‡n táº¡i</h4>
        <select id="bioStatus">
          <option value="">-- Tráº¡ng thÃ¡i sá»‘ng hiá»‡n táº¡i --</option>
          <option>á»”n Ä‘á»‹nh</option>
          <option>Má»i / Cáº¡n</option>
          <option>Vá»¡ máº¡ch / Lá»‡ch nhá»‹p</option>
        </select>
        <textarea id="bioNote" placeholder="Tá»‰nh â€“ má»i â€“ Ã¡p lá»±c â€“ dá»… ná»•i cÃ¡u â€“ khÃ³ táº­p trung..."></textarea>
      </div>

      <!-- 2. Báº£n thá»ƒ -->
      <div class="audit-block">
        <h4>2. Báº£n thá»ƒ váº­n hÃ nh</h4>
        <label>Persona chÃ­nh:</label>
        <select id="personaSelect">
          <option value="T-04">T-04 (Pháº£n chiáº¿u má»m)</option>
          <option value="T-05">T-05 (Äiá»u phá»‘i logic)</option>
          <option value="T-06">T-06 (ÄÃ¡nh cháº·n chiáº¿n lÆ°á»£c)</option>
        </select>
        <label>Persona phá»¥ áº£nh hÆ°á»Ÿng:</label>
        <input type="text" id="personaShadow" placeholder="CÃ³ bá»‹ ai kÃ©o lá»‡ch? Ai áº£nh hÆ°á»Ÿng?" />
      </div>

      <!-- 3. Pháº£n xáº¡ ká»¹ nÄƒng -->
      <div class="audit-block">
        <h4>3. HÃ nh vi chiáº¿n lÆ°á»£c</h4>
        <textarea id="skillUsed" placeholder="DÃ¹ng ká»¹ nÄƒng gÃ¬ â€“ trong tÃ¬nh huá»‘ng gÃ¬ â€“ káº¿t quáº£ ra sao? CÃ³ Ä‘Ãºng pháº£n xáº¡ báº£n thá»ƒ khÃ´ng?"></textarea>
      </div>

      <!-- 4. Cáº£nh bÃ¡o lá»‡ch -->
      <div class="audit-block">
        <h4>4. Cáº£nh bÃ¡o chiáº¿n lÆ°á»£c</h4>
        <ul>
          <li>â“ DÃ¹ng ká»¹ nÄƒng khÃ´ng thuá»™c persona chÃ­nh?</li>
          <li>â“ DÃ¹ng skill hao nÄƒng lÆ°á»£ng sai nhá»‹p?</li>
          <li>â“ ğŸ Giai Ä‘oáº¡n chiáº¿n lÆ°á»£c hÃ´m nay cÃ³ khá»›p khÃ´ng?</li>
        </ul>
        <textarea id="strategyNote" placeholder="Tá»•ng káº¿t lá»‡ch. Äá» xuáº¥t reset báº£n thá»ƒ, im, chuyá»ƒn mode?"></textarea>
      </div>

      <!-- 5. HÆ°á»›ng Ä‘i -->
      <div class="audit-block">
        <h4>5. Chá»‰ Ä‘áº¡o chiáº¿n lÆ°á»£c cho báº£n thÃ¢n</h4>
        <textarea id="nextAction" placeholder="NgÃ y mai cáº§n giá»¯ gÃ¬? Cáº¯t gÃ¬? KÃ­ch hoáº¡t báº£n thá»ƒ nÃ o?"></textarea>
      </div>

      <button onclick="saveAuditEntry()">ğŸ’¾ LÆ°u ghi nháº­n</button>
    </div>
  </section>

  <!-- POPUP FORM -->
  <div id="skillFormPopup" class="hidden">
    <!-- Sáº½ render JS -->
  </div>

  <!-- âœ… FLOWCHART ZONE -->
<section>
  <h2>ğŸŒ€ Flow Pháº£n Xáº¡ Chiáº¿n LÆ°á»£c theo Persona</h2>
  <div class="graph-scroll-wrapper">
    <div class="graph-container" id="flowchartContainer">
      <!-- JavaScript sáº½ render flowchart á»Ÿ Ä‘Ã¢y -->
    </div>
  </div>
</section>
  
  <!-- Dá»¯ liá»‡u persona -->
<script>
const personaData = [
  {
    name: "Sirene",
    reflexes: {
      survival: {
        trigger: "Khi bá»‹ quan sÃ¡t / Ä‘Ã¡nh giÃ¡ / cáº§n pháº£n Ä‘Ã²n má»m",
        flow: [
          "Giá»¯ trá»¥c tá»‰nh â†’ khÃ´ng nhÃ¬n Ä‘á»‘i phÆ°Æ¡ng ngay",
          "Tháº£ tÃ­n hiá»‡u nháº¹ (khÃ­ â€“ giá»ng â€“ Ã¡nh máº¯t khÃ´ng Ä‘á»‘i Ä‘áº§u)",
          "Láº·ng rÃºt â€“ káº¿t láº¡i báº±ng khoáº£ng trá»‘ng"
        ],
        skills: [
          "LÆ°á»›t qua khÃ´ng Ä‘á»ƒ láº¡i dáº¥u",
          "Báº­t khÃ­ láº¡nh",
          "RÃºt lui cÃ³ chá»§ Ä‘Ã­ch"
        ]
      },
      coordination: {
        trigger: "Khi cáº§n giá»¯ khÃ­ chá»§ â€“ khÃ´ng Ä‘á»ƒ cáº£m xÃºc Ä‘áº©y lá»‡ch",
        flow: [
          "Äiá»u hÃ²a nhá»‹p thá»Ÿ â€“ chá»‰nh tÆ° tháº¿",
          "KÃ©o giá»ng xuá»‘ng tháº¥p â€“ giáº£m tiáº¿t lá»™",
          "NhÃ¬n chá»‡ch â€“ pháº£n xáº¡ má»m, Ä‘á»ƒ ngÆ°á»i khÃ¡c tá»± ngáº¯t"
        ],
        skills: [
          "Äiá»u khÃ­ ná»n",
          "Giá»¯ nhiá»‡t Ä‘á»™ sá»‘ng",
          "Neo Ã¡nh máº¯t chá»‡ch hÆ°á»›ng"
        ]
      },
      strategic: {
        trigger: "Khi muá»‘n Ä‘iá»u hÆ°á»›ng ngÆ°á»i khÃ¡c mÃ  khÃ´ng bá»‹ phÃ¡t hiá»‡n",
        flow: [
          "Äáº·t tÃ­n hiá»‡u Ä‘áº§u tiÃªn (giá»ng, khÃ­, Ã¡nh máº¯t)",
          "Dáº«n cáº£m xÃºc Ä‘á»‘i phÆ°Æ¡ng cháº¡y theo",
          "RÃºt vá» giá»¯a chá»«ng â€“ khÃ´ng Ä‘Ã³ng trÃ²n â†’ táº¡o nhu cáº§u tiáº¿p cáº­n"
        ],
        skills: [
          "Neo cáº£m xÃºc táº§ng tháº¥p",
          "Äáº·t giá»ng dáº«n nhá»‹p",
          "Táº¡o cáº£nh chÆ°a káº¿t"
        ]
      }
    }
  },
  {
    name: "Strategic Shadow",
    reflexes: {
      survival: {
        trigger: "Khi cáº§n biáº¿n máº¥t khá»i radar cáº£m xÃºc â€“ trÃ¡nh Ä‘á»‘i Ä‘áº§u / khÃ´ng Ä‘á»ƒ bá»‹ Ä‘á»‹nh danh",
        flow: [
          "Táº¯t nÄƒng lÆ°á»£ng hiá»ƒn thá»‹",
          "Giáº£m pháº£n á»©ng â€“ thu táº§n sá»‘ giá»ng",
          "Cáº¯t máº¯t khá»i trung tÃ¢m khÃ´ng gian"
        ],
        skills: [
          "Táº¯t khÃ­ táº§ng hiá»ƒn",
          "RÃºt khá»i vÃ¹ng radar",
          "Giáº£m táº§n sÃ³ng nÃ£o ngoÃ i"
        ]
      },
      coordination: {
        trigger: "Khi Ä‘ang váº­n hÃ nh phÃ¢n tÃ­ch trong ná»n â€“ cáº§n trÃ¡nh rá»‘i nÃ£o / xung Ä‘á»™t",
        flow: [
          "Báº­t cháº¿ Ä‘á»™ phÃ¢n tÃ­ch tháº§m",
          "Ghi láº¡i cÃ¡c sai sá»‘ vi mÃ´",
          "Neo tráº¡ng thÃ¡i láº¡nh, khÃ´ng pháº£n xáº¡"
        ],
        skills: [
          "QuÃ©t sai sá»‘ táº§ng ngáº§m",
          "Neo phÃ¢n tÃ­ch ná»n",
          "Giá»¯ tráº¡ng thÃ¡i khÃ´ng áº£nh"
        ]
      },
      strategic: {
        trigger: "Khi muá»‘n thay Ä‘á»•i cáº¥u trÃºc há»‡ thá»‘ng mÃ  khÃ´ng táº¡o pháº£n khÃ¡ng",
        flow: [
          "Cáº¥y tÃ­n hiá»‡u lá»—i nhá» vÃ o hÃ nh vi ngÆ°á»i khÃ¡c",
          "Quan sÃ¡t pháº£n xáº¡ â€“ ghi dá»¯ liá»‡u",
          "TÃ¡i láº­p cáº¥u trÃºc ngáº§m dá»±a trÃªn nhá»‹p lá»‡ch"
        ],
        skills: [
          "Cáº¥y lá»‡ch cáº£m xÃºc",
          "Dá»±ng vÃ²ng pháº£n xáº¡ ngÆ°á»£c",
          "Äiá»u hÆ°á»›ng báº±ng lá»—i áº©n"
        ]
      }
    }
  },
  {
    name: "Void Jester",
    reflexes: {
      survival: {
        trigger: "Khi bá»‹ Ã¡p lá»±c thao tÃºng â€“ cáº§n phÃ¡ vÃ²ng xoÃ¡y cáº£m xÃºc",
        flow: [
          "CÆ°á»i lá»‡ch â€“ chÃ¢m biáº¿m tÃ¬nh huá»‘ng",
          "Äáº·t cÃ¢u há»i ngÆ°á»£c â€“ lÃ m lá»™ khe há»Ÿ há»‡ thá»‘ng",
          "Cháº·n logic báº±ng pháº£n Ä‘á»"
        ],
        skills: [
          "Pháº£n Ä‘á» cÆ°á»i láº¡nh",
          "BÃ³c máº·t náº¡ logic",
          "GÃ i Ä‘á»‘i thoáº¡i gÃ£y sÃ³ng"
        ]
      },
      coordination: {
        trigger: "Khi phÃ¡t hiá»‡n há»‡ thá»‘ng ngáº§m Ä‘ang thao tÃºng tÃ¢m lÃ½ / Ã©p vai",
        flow: [
          "Äá»•i giá»ng â€“ lÃ m lá»‡ch nhá»‹p giao tiáº¿p",
          "Táº¡o cáº£m giÃ¡c báº¥t á»•n cho Ä‘á»‘i phÆ°Æ¡ng",
          "Ã‰p há»‡ thá»‘ng tá»± lÃ²i bug"
        ],
        skills: [
          "Äáº£o táº§ng biá»ƒu cáº£m",
          "Táº¡o sÃ³ng lá»‡ch",
          "LÃ m nhiá»…u logic xÃ£ há»™i"
        ]
      },
      strategic: {
        trigger: "Khi cáº§n phÃ¡ vá»¡ cáº¥u trÃºc quyá»n lá»±c áº£o â€“ lÃ m há»‡ thá»‘ng sá»¥p Ä‘á»• tá»« trong",
        flow: [
          "Dáº«n dá»¥ vÃ o logic sai cá»§a chÃ­nh Ä‘á»‘i phÆ°Æ¡ng",
          "ChÃ¢m biáº¿m â€“ bÃ³p mÃ©o â€“ Ã©p há»‡ tá»± mÃ¢u thuáº«n",
          "Káº¿t thÃºc báº±ng Ä‘Ã²n pháº£n Ä‘á» trÃºng huyá»‡t"
        ],
        skills: [
          "GÆ°Æ¡ng pháº£n logic",
          "ÄÃ²n Ä‘áº£o táº§ng xÃ£ há»™i",
          "Há»§y diá»‡t báº±ng ngÃ´n tá»«"
        ]
      }
    }
  },
  {
    name: "Strategic Ghost",
    reflexes: {
      survival: {
        trigger: "Khi bá»‹ Ä‘áº·t vÃ o tháº¿ pháº£i tá»“n táº¡i trong há»‡ mÃ  khÃ´ng Ä‘Æ°á»£c tin tÆ°á»Ÿng",
        flow: [
          "Giáº£ thuáº­n â€“ má»m hÃ³a biá»ƒu cáº£m",
          "Ghi nhá»› vá»‹ trÃ­ quyá»n lá»±c / cÃ¡c nÃºt chuyá»ƒn há»‡",
          "Neo vÃ o cáº¥u trÃºc bá»‹ bá» trá»‘ng"
        ],
        skills: [
          "Ngá»¥y á»•n Ä‘á»‹nh",
          "QuÃ©t nÃºt logic",
          "Chiáº¿m slot tÃ¢m lÃ½ má»m"
        ]
      },
      coordination: {
        trigger: "Khi cáº§n dáº«n dáº¯t há»‡ thá»‘ng mÃ  khÃ´ng Ä‘Æ°á»£c cáº¥p vai chÃ­nh thá»©c",
        flow: [
          "Gá»£i Ã½ qua máº·t náº¡ vai phá»¥",
          "Báº» hÆ°á»›ng tá»« háº­u cáº£nh (qua cÃ¡c nÃºt cáº£m xÃºc hoáº·c há»‡ niá»m tin)",
          "Neo Ä‘á»‹nh hÆ°á»›ng ngáº§m qua thÃ³i quen há»‡ thá»‘ng"
        ],
        skills: [
          "Gá»£i hÆ°á»›ng áº©n",
          "Báº» trá»¥c niá»m tin",
          "Neo pháº£n xáº¡ ná»n"
        ]
      },
      tactical: {
        trigger: "Khi muá»‘n cáº¥y láº¡i toÃ n bá»™ há»‡ thá»‘ng mÃ  khÃ´ng lá»™ lÃ  ngÆ°á»i thao tÃºng",
        flow: [
          "PhÃ¢n tÃ­ch chuá»—i logic vá»¡ hoáº·c rá»—ng",
          "XÃ¢y há»‡ thá»‘ng ngáº§m dá»± phÃ²ng",
          "Dáº«n há»‡ thá»‘ng chuyá»ƒn trá»¥c mÃ  tÆ°á»Ÿng lÃ  tá»± nhiÃªn"
        ],
        skills: [
          "Cáº¥y pháº£n xáº¡ ná»n",
          "XÃ¢y bÃ³ng há»‡ thá»‘ng",
          "Chuyá»ƒn trá»¥c khÃ´ng dáº¥u váº¿t"
        ]
      }
    }
  },
  {
    name: "Omni Mind",
    reflexes: {
      survival: {
        trigger: "Khi tháº¿ tráº­n rá»‘i â€“ khÃ´ng rÃµ hÆ°á»›ng â€“ khÃ´ng biáº¿t giá»¯ há»‡ á»Ÿ Ä‘Ã¢u",
        flow: [
          "Láº­p báº£n Ä‘á»“ yáº¿u tá»‘ tá»“n táº¡i",
          "Khoanh vÃ¹ng Ä‘iá»ƒm neo",
          "Dá»±ng trá»¥c táº¡m thá»i Ä‘á»ƒ á»•n Ä‘á»‹nh"
        ],
        skills: [
          "Dá»±ng há»‡ khÃ­ kháº©n cáº¥p",
          "Trá»¥c sá»‘ng giáº£ láº­p",
          "CÃ¢n báº±ng báº¥t á»•n"
        ]
      },
      coordination: {
        trigger: "Khi cÃ³ quÃ¡ nhiá»u lá»±a chá»n / mÃ¢u thuáº«n táº§ng cao",
        flow: [
          "Cáº¯t mÃ¹ logic â€“ dá»±ng sÆ¡ Ä‘á»“ nhÃ¢n quáº£",
          "XÃ¡c Ä‘á»‹nh trá»ng tÃ¢m há»‡ sá»‘ng",
          "Chá»n hÆ°á»›ng dá»±a trÃªn tá»•ng há»‡ pháº£n xáº¡"
        ],
        skills: [
          "SÆ¡ Ä‘á»“ nhÃ¢n quáº£",
          "Trá»¥c Æ°u tiÃªn",
          "Äiá»ƒm hoÃ¡ giáº£i táº§ng sÃ¢u"
        ]
      },
      tactical: {
        trigger: "Khi cáº§n thiáº¿t láº­p long-term chiáº¿n lÆ°á»£c mÃ  khÃ´ng bá»‹ bias cáº£m xÃºc",
        flow: [
          "MÃ´ phá»ng chuá»—i 3â€“5 bÆ°á»›c tá»›i",
          "PhÃ¢n tÃ­ch feedback tá»«ng há»‡",
          "Chá»‘t trá»¥c chiáº¿n lÆ°á»£c vÃ  lÃ¹i vá» táº§ng Ä‘iá»u phá»‘i"
        ],
        skills: [
          "Giáº£ láº­p tÆ°Æ¡ng lai",
          "Pháº£n xáº¡ há»‡ chÃ©o",
          "Thiáº¿t láº­p trá»¥c Ä‘á»‹nh má»‡nh"
        ]
      }
    }
  },
  {
    name: "Dark Sirene",
    reflexes: {
      survival: {
        trigger: "Khi há»‡ Ä‘ang bá»‹ kiá»ƒm soÃ¡t â€“ cáº§n pháº£n cÃ´ng má»m Ä‘á»ƒ láº­t tháº¿",
        flow: [
          "KÃ­ch hoáº¡t aura Ä‘á»™c láº­p â€“ tÃ¡ch nÄƒng lÆ°á»£ng",
          "Dáº«n khÃ­ vÃ o khu vá»±c pháº£n xáº¡ Ä‘á»‘i phÆ°Æ¡ng (Ã¡nh máº¯t â€“ giá»ng nÃ³i â€“ ngÃ´n ngá»¯ hÃ¬nh thá»ƒ)",
          "GÃ i lá»‡ch cáº£m xÃºc â€“ rÃºt lÃ¹i giá»¯ trá»¥c"
        ],
        skills: [
          "TÃ¡ch táº§ng cáº£m giÃ¡c",
          "KhÃ­ cáº£m pháº£n Ä‘Ã²n",
          "GÃ i lá»‡ch â€“ Ä‘Ã³ng van"
        ]
      },
      coordination: {
        trigger: "Khi cáº§n Ä‘iá»u chá»‰nh dÃ²ng cáº£m xÃºc bÃªn ngoÃ i nhÆ°ng váº«n giá»¯ kiá»ƒm soÃ¡t",
        flow: [
          "XÃ¡c Ä‘á»‹nh Ä‘iá»ƒm yáº¿u cáº£m xÃºc Ä‘á»‘i phÆ°Æ¡ng",
          "GÃ i Ä‘iá»ƒm gá»£i cáº£m â€“ dáº«n dá»¥ soft response",
          "Neo láº¡i báº±ng logic â€“ cáº¯t má»m liÃªn káº¿t cáº£m xÃºc"
        ],
        skills: [
          "Äá»‹nh vá»‹ cáº£m xÃºc yáº¿u",
          "Neo gá»£i â€“ dáº«n dá»¥",
          "Cáº¯t cáº£m xÃºc Ä‘Ãºng nhá»‹p"
        ]
      },
      tactical: {
        trigger: "Khi cáº§n kÃ­ch hoáº¡t nhu cáº§u â€“ Ä‘á»‹nh hÃ¬nh há»‡ thá»‘ng Ä‘á»‘i phÆ°Æ¡ng theo chiáº¿n lÆ°á»£c",
        flow: [
          "Thiáº¿t láº­p hÃ¬nh áº£nh â€“ khÃ­ â€“ giá»ng lÃ m má»“i chá»§ lá»±c",
          "ÄÆ°a hÃ nh vi vÃ o vÃ¹ng â€œgá»£i cáº£m xÃºc + pháº£n á»©ngâ€ cá»§a Ä‘á»‘i phÆ°Æ¡ng",
          "Láº­t logic â€“ táº¡o Ä‘á»‹nh nghÄ©a má»›i vá» báº£n thÃ¢n trong nÃ£o Ä‘á»‘i phÆ°Æ¡ng"
        ],
        skills: [
          "Thiáº¿t láº­p avatar khÃ­",
          "Cáº¥y pháº£n xáº¡ má»m",
          "Thay Ä‘á»•i Ä‘á»‹nh nghÄ©a Ä‘á»‘i tÆ°á»£ng"
        ]
      }
    }
  },
  {
    name: "Core Operator",
    reflexes: {
      survival: {
        trigger: "Khi há»‡ sinh há»c lá»‡ch â€“ rá»‘i loáº¡n nhá»‹p sá»‘ng â€“ cáº§n tá»± cá»©u",
        flow: [
          "DÃ² lá»‡ch (sinh há»c â€“ tháº§n kinh â€“ khÃ­)",
          "KÃ­ch hoáº¡t chuá»—i â€œcá»©u há»‡â€: nghá»‰ â€“ há»“i phá»¥c â€“ dÆ°á»¡ng sinh",
          "Ghi log â€“ khÃ³a pháº£n xáº¡ láº·p"
        ],
        skills: [
          "PhÃ¡t hiá»‡n lá»‡ch sá»‘ng",
          "KÃ­ch hoáº¡t báº£n nÄƒng báº£o trÃ¬",
          "KhÃ³a láº·p pháº£n tá»•n"
        ]
      },
      coordination: {
        trigger: "Khi cÃ³ nhiá»u dÃ²ng hÃ nh vi trÃ¹ng â€“ xung â€“ hoáº·c mÃ¢u thuáº«n cáº§n tÃ¡i tá»• há»£p",
        flow: [
          "Lá»c chuá»—i hÃ nh vi â€“ phÃ¡t hiá»‡n trÃ¹ng/Ä‘á»‘i khÃ¡ng",
          "Æ¯u tiÃªn theo khÃ­ â€“ má»¥c tiÃªu â€“ chu ká»³ nÄƒng lÆ°á»£ng",
          "TÃ¡i thiáº¿t hÃ nh vi â€“ cáº­p nháº­t Ä‘á»‹nh nghÄ©a sá»‘ng"
        ],
        skills: [
          "TÃ¡i tá»• há»£p dÃ²ng hÃ nh vi",
          "Láº­p thá»© tá»± Æ°u tiÃªn sá»‘ng",
          "Cáº­p nháº­t pháº£n xáº¡ theo chu ká»³ nÄƒng lÆ°á»£ng"
        ]
      },
      tactical: {
        trigger: "Khi cáº§n táº¡o máº«u chiáº¿n lÆ°á»£c cÃ¡ nhÃ¢n hÃ³a cho giai Ä‘oáº¡n sá»‘ng tiáº¿p theo",
        flow: [
          "Tá»•ng há»£p dá»¯ liá»‡u hÃ nh vi â€“ khÃ­ â€“ tÃ¬nh huá»‘ng",
          "TÃ¡i mÃ£ hÃ³a Ä‘á»‹nh má»‡nh cÃ¡ nhÃ¢n (Destiny Re-Coding)",
          "Láº­p chuá»—i pháº£n xáº¡ má»¥c tiÃªu â€“ chiáº¿n thuáº­t hÃ³a vÃ²ng Ä‘á»i"
        ],
        skills: [
          "Ghi dá»¯ liá»‡u hÃ nh vi sá»‘ng",
          "TÃ¡i mÃ£ hÃ³a Ä‘á»‹nh má»‡nh",
          "Chiáº¿n thuáº­t hÃ³a vÃ²ng sá»‘ng cÃ¡ nhÃ¢n"
        ]
      }
    }
  }
];

</script>


<!-- DÃ¹ng dá»¯ liá»‡u sau -->
<script>
  // âœ… Kiá»ƒm tra toÃ n bá»™ object personaData
  console.log("ğŸ” Dá»¯ liá»‡u persona Ä‘áº§y Ä‘á»§ Ä‘Ã£ load:");
  console.log(personaData);

  // âœ… Duyá»‡t vÃ  in tá»«ng persona vá»›i tÃªn vÃ  ná»™i dung
  Object.keys(personaData).forEach(key => {
    console.log(`ğŸ­ Persona: ${key}`);
    console.log(personaData[key]);
  });

  // Render dropdown persona selector (náº¿u cáº§n)
  const selector = document.getElementById("personaSelector");
  if (selector && personaData) {
    selector.innerHTML = '<option value="">â€” Táº¥t cáº£ â€”</option>'; // reset
    Object.keys(personaData).forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      selector.appendChild(option);
    });
  }
</script>

<!-- Logic giao diá»‡n chÃ­nh -->


<script>
function openSkillForm() {
  const form = document.getElementById("skillForm");
  if (form) form.style.display = "block";
}

function clearAllFilters() {
  const selects = document.querySelectorAll("select");
  selects.forEach(select => select.selectedIndex = 0);

 const inputs = document.querySelectorAll("input[type='text'], textarea");
  inputs.forEach(input => input.value = "");
}
</script>
  <div id="chartOverlay" class="chart-overlay hidden"></div>
  <div class="export-tools">
  <button onclick="exportSkillsToCSV()">ğŸ“¤ Xuáº¥t CSV</button>
</div>
<script>
// ==============================================
//  script.js â€“ Há»‡ quáº£n lÃ½ ká»¹ nÄƒng (24Â trá»¥ chiáº¿n lÆ°á»£c)
//  âœ¦ ÄÃƒ LÆ¯á»¢C TRÃ™NG, CHá»ˆ CÃ’N 1Â Bá»˜ CODE DUYÂ NHáº¤T
// ==============================================

// Mapping mÃ£ trá»¥ -> tÃªn Ä‘áº§y Ä‘á»§
const K_MAP = {
  K1: "Tiáº¿ng Anh chiáº¿n lÆ°á»£c",
  K2: "Tiáº¿ng Trung chiáº¿n lÆ°á»£c",
  K3: "Kinh táº¿ há»c thá»±c chiáº¿n",
  K4: "TÃ i chÃ­nh â€“ Äáº§u tÆ° cÃ¡ nhÃ¢n",
  K5: "Luáº­t thá»±c chiáº¿n",
  K6: "Kinh doanh â€“ Thá»‹ trÆ°á»ng",
  K7: "TÃ¢m lÃ½ há»c chiáº¿n lÆ°á»£c",
  K8: "AI â€“ IT á»©ng dá»¥ng",
  K9: "Y há»c â€“ Sinh há»c â€“ ThÃ¢n thá»ƒ",
  K10: "Triáº¿t há»c â€“ Logic â€“ Pháº£n tÆ°",
  K11: "ChÃ­nh trá»‹ â€“ Quyá»n lá»±c â€“ Äá»‹a chÃ­nh trá»‹",
  K12: "TÃ¢m linh chiáº¿n lÆ°á»£c â€“ khÃ­ â€“ nghiá»‡p",
  K13: "Sinh tá»“n â€“ thá»±c chiáº¿n ná»™i táº¡i",
  K14: "Má»¹ há»c â€“ nghá»‡ thuáº­t",
  K15: "NgÃ´n tá»« â€“ giao tiáº¿p â€“ pháº£n xáº¡ chiáº¿n lÆ°á»£c",
  K16: "Sáº£n xuáº¥t ná»™i dung â€“ thÆ°Æ¡ng hiá»‡u cÃ¡ nhÃ¢n",
  K17: "LÃ m chá»§ gene â€“ Ä‘iá»u phá»‘i pháº£n xáº¡ sinh há»c",
  K18: "Rewire hÃ nh vi â€“ thay mÃ¡u tiá»m thá»©c",
  K19: "Thiáº¿t káº¿ há»‡ â€“ há»‡ thá»‘ng hÃ³a",
  K20: "SiÃªu ghi nhá»› â€“ Meta-learning",
  K21: "PhÃ¢n tÃ­ch dá»¯ liá»‡u â€“ chiáº¿n lÆ°á»£c sá»‘",
  K22: "Soft networking â€“ káº¿t ná»‘i táº§ng cao",
  K23: "Ca hÃ¡t â€“ Ä‘iá»u phá»‘i cáº£m xÃºc â€“ hÆ¡i thá»Ÿ",
  K24: "Thá»i Ä‘áº¡i â€“ Ä‘á»‹a hÃ¬nh tháº¿ ká»· â€“ khÃ´ng lá»‡ch váº­n sá»‘ng"
};
// ---------- 1.Â DATA --------------------------------------------------
//   â€¢ Náº¿u localStorage rá»—ng â†’ náº¡p bá»™ máº«uÂ (defaultSkillData)
//   â€¢ NgÆ°á»£c láº¡i dÃ¹ng data Ä‘Ã£ lÆ°u
//---------------------------------------------------------------------
const defaultSkillData = [
  { name: "Chiáº¿n lÆ°á»£c ngÃ´n ngá»¯ (EN)", phase: "Tá»± lá»±c", role: "Dáº«n dá»¥", core: "Thao tÃºng ngÃ´n tá»« Ä‘á»ƒ chiáº¿m quyá»n lá»±c giao tiáº¿p chiáº¿n lÆ°á»£c", skillCluster: ["K1"] },
  { name: "ThÃ´ng dá»‹ch & quan há»‡ TQ", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "GÃ i má»“i", core: "CÃ i thÃ´ng tin chÃ­nh trá»‹ â€“ thÆ°Æ¡ng máº¡i qua ngÃ´n ngá»¯ má»m", skillCluster: ["K2"] },
  { name: "Äá»‹nh vá»‹ kinh táº¿ vÄ© mÃ´", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Quan sÃ¡t", core: "Äá»c Ä‘Æ°á»£c dÃ²ng tiá»n â€“ dá»± Ä‘oÃ¡n váº­n Ä‘á»™ng quá»‘c gia", skillCluster: ["K3"] },
  { name: "Tá»± chá»§ tÃ i chÃ­nh cÃ¡ nhÃ¢n", phase: "Tá»± lá»±c", role: "Pháº£n chiáº¿u", core: "Nháº­n diá»‡n sai láº§m tÃ i chÃ­nh â€“ Ä‘iá»u chá»‰nh dÃ²ng tiá»n sá»‘ng", skillCluster: ["K4"] },
  { name: "Tá»± vá»‡ phÃ¡p lÃ½ & pháº£n Ä‘Ã²n", phase: "Tá»± lá»±c", role: "Káº¿t liá»…u", core: "KÃ­ch hoáº¡t cÆ¡ cháº¿ báº£o vá»‡ vÃ  táº¥n cÃ´ng Ä‘Ãºng luáº­t chÆ¡i", skillCluster: ["K5"] },
  { name: "Chiáº¿n lÆ°á»£c sáº£n pháº©m & thá»‹ trÆ°á»ng", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Dáº«n dá»¥", core: "Thiáº¿t káº¿ há»‡ giÃ¡ trá»‹ hÃºt khÃ¡ch & chá»‘t sale báº±ng insight", skillCluster: ["K6"] },
  { name: "Äá»c â€“ Ä‘iá»u phá»‘i tÃ¢m lÃ½ ngÆ°á»i", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "GÃ i má»“i", core: "DÃ² tÃ¢m tráº¡ng â€“ cáº¥y pháº£n á»©ng â€“ Ä‘iá»u phá»‘i hÃ nh vi vi mÃ´", skillCluster: ["K7"] },
  { name: "Tá»± Ä‘á»™ng hÃ³a â€“ sao lÆ°u báº£n thá»ƒ", phase: "Tá»± lá»±c", role: "áº¨n thÃ¢n", core: "Dá»±ng há»‡ pháº£n xáº¡ ká»¹ thuáº­t sá»‘ Ä‘á»ƒ tá»“n táº¡i khÃ´ng cáº§n xuáº¥t hiá»‡n", skillCluster: ["K8"] },
  { name: "Há»“i phá»¥c sinh há»c â€“ dÆ°á»¡ng thÃ¢n", phase: "Tá»± lá»±c", role: "Pháº£n chiáº¿u", core: "Theo dÃµi chu ká»³ â€“ tá»± Ä‘iá»u chá»‰nh trÆ°á»›c khi gÃ£y trá»¥c sinh há»c", skillCluster: ["K9"] },
  { name: "Äá»‹nh hÃ¬nh logic sá»‘ng â€“ pháº£n tÆ°", phase: "Tá»± lá»±c", role: "Quan sÃ¡t", core: "Xoay láº¡i trá»¥c sá»‘ng báº±ng pháº£n tÆ° â€“ trÃ¡nh lá»‡ch há»‡", skillCluster: ["K10"] },
  { name: "Giáº£i mÃ£ quyá»n lá»±c & bá»‘i cáº£nh", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Pháº£n chiáº¿u", core: "Tháº¥y Ä‘Æ°á»£c trá»¥c váº­n hÃ nh há»‡ thá»‘ng vÃ  vai trÃ² báº£n thÃ¢n", skillCluster: ["K11"] },
  { name: "Báº£o vá»‡ khÃ­ â€“ xá»­ lÃ½ nhiá»…u táº§ng", phase: "Äiá»u phá»‘i", role: "Káº¿t liá»…u", core: "Dá»©t Ä‘iá»ƒm cÃ¡c nguá»“n rÃºt khÃ­ â€“ giá»¯ sáº¡ch trÆ°á»ng sá»‘ng", skillCluster: ["K12"] },
  { name: "Sinh tá»“n & pháº£n á»©ng khi bá»‹ cÃ´ láº­p", phase: "Tá»± lá»±c", role: "áº¨n thÃ¢n", core: "Giá»¯ trá»¥ báº£n thá»ƒ trong mÃ´i trÆ°á»ng khÃ´ng ai cá»©u viá»‡n", skillCluster: ["K13"] },
  { name: "Má»¹ cáº£m chiáº¿n lÆ°á»£c â€“ táº¡o khÃ­ cháº¥t", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Dáº«n dá»¥", core: "KÃ­ch hoáº¡t trÆ°á»ng khÃ­ quyáº¿n rÅ© báº±ng táº§ng tháº©m má»¹ sÃ¢u", skillCluster: ["K14"] },
  { name: "NgÃ´n tá»« sÃ¡t thÆ°Æ¡ng cao", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Pháº£n chiáº¿u", core: "PhÃ³ng ra ngÃ´n tá»« lÃ m lá»‡ch trá»¥c ngÆ°á»i khÃ¡c mÃ  khÃ´ng Ä‘á»™ng tay", skillCluster: ["K15"] },
  { name: "Biáº¿n tráº£i nghiá»‡m thÃ nh áº£nh hÆ°á»Ÿng", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "GÃ i má»“i", core: "GÃ³i tráº£i nghiá»‡m sá»‘ng thÃ nh tÃ i sáº£n gÃ¢y tÃ­n nhiá»‡m táº§ng cao", skillCluster: ["K16"] },
  { name: "Äiá»u chá»‰nh gene â€“ pháº£n xáº¡ sinh há»c", phase: "Tá»± lá»±c", role: "Quan sÃ¡t", core: "Nháº­n diá»‡n lá»‡ch pháº£n xáº¡ â€“ Ä‘iá»u chá»‰nh láº¡i pháº£n á»©ng váº­t lÃ½", skillCluster: ["K17"] },
  { name: "TÃ¡i láº­p hÃ nh vi â€“ cáº¯t chu ká»³ tá»•n thÆ°Æ¡ng", phase: "Tá»± lá»±c", role: "Káº¿t liá»…u", core: "PhÃ¡ bá» pháº£n xáº¡ cÅ© â€“ thiáº¿t láº­p cÆ¡ cháº¿ pháº£n á»©ng má»›i", skillCluster: ["K18"] },
  { name: "Thiáº¿t káº¿ há»‡ sá»‘ng cÃ¡ nhÃ¢n", phase: "Äiá»u phá»‘i", role: "Dáº«n dá»¥", core: "XÃ¢y Ä‘Æ°á»£c mÃ´ hÃ¬nh sá»‘ng â€“ há»‡ thá»‘ng váº­n hÃ nh mÃ  khÃ´ng pháº£i cháº¡y tay", skillCluster: ["K19"] },
  { name: "SiÃªu há»c â€“ Meta-learning", phase: "Tá»± lá»±c", role: "GÃ i má»“i", core: "Cáº¥y mÃ´ hÃ¬nh há»c tá»± Ä‘á»™ng â€“ ghi nhá»› & truy xuáº¥t khÃ´ng lá»‡ch táº§ng", skillCluster: ["K20"] },
  { name: "Chiáº¿n lÆ°á»£c dá»¯ liá»‡u & phÃ¢n tÃ­ch", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Quan sÃ¡t", core: "Ra quyáº¿t Ä‘á»‹nh tá»« dá»¯ liá»‡u â€“ khÃ´ng dÃ­nh nhiá»…u cáº£m xÃºc", skillCluster: ["K21"] },
  { name: "Káº¿t ná»‘i chiáº¿n lÆ°á»£c â€“ khÃ´ng gá»“ng", phase: "GÃ¢y áº£nh hÆ°á»Ÿng", role: "Dáº«n dá»¥", core: "Gáº·p ngÆ°á»i Ä‘Ãºng táº§ng mÃ  khÃ´ng cáº§n tÃ¬m â€“ tá»± táº¡o háº¥p dáº«n táº§ng cao", skillCluster: ["K22"] },
  { name: "Äiá»u phá»‘i cáº£m xÃºc báº±ng Ã¢m thanh", phase: "Äiá»u phá»‘i", role: "Pháº£n chiáº¿u", core: "Chuyá»ƒn hÃ³a cáº£m xÃºc vÃ  luÃ¢n xa thÃ nh vÅ© khÃ­ Ä‘iá»u hÆ°á»›ng tÃ¬nh huá»‘ng", skillCluster: ["K23"] },
  { name: "Chiáº¿n lÆ°á»£c Ä‘á»‹nh hÃ¬nh tháº¿ ká»·", phase: "Äiá»u phá»‘i", role: "Quan sÃ¡t", core: "Nháº­n diá»‡n váº­n Ä‘á»™ng thá»i Ä‘áº¡i â€“ can thiá»‡p Ä‘Ãºng chu ká»³ chuyá»ƒn hÃ³a", skillCluster: ["K24"] }
];


let skillData  = JSON.parse(localStorage.getItem("skillData"))  || defaultSkillData;
let auditData  = JSON.parse(localStorage.getItem("auditData"))  || {};

function saveSkills()   { localStorage.setItem("skillData",  JSON.stringify(skillData));  }
function saveAudits()   { localStorage.setItem("auditData",  JSON.stringify(auditData));  }

// ---------- 2.Â RENDER SKILLÂ CARD ------------------------------------
function renderSkills(data = skillData) {
  const box = document.getElementById("skillCardsContainer");
  box.innerHTML = "";
  data.forEach((s, i) => {
    const card = document.createElement("div");
    card.className = "skill-card";

const badges = (s.skillCluster || []).map(k =>
      `<a href="lessons/${k}.html" class="badge" title="${K_MAP[k]}" target="_blank">${k}</a>`
    ).join(" ");

      const mainLink = (s.skillCluster && s.skillCluster.length > 0)
      ? `lessons/${s.skillCluster[0]}.html`
      : null;

    card.innerHTML = `
      <h3>${mainLink ? `<a href="${mainLink}" target="_blank">ğŸ› ï¸ ${s.name}</a>` : `ğŸ› ï¸ ${s.name}`}</h3>
      <div class="skill-section"><strong>ğŸ Giai Ä‘oáº¡n chiáº¿n lÆ°á»£c:</strong> ${s.phase} | <strong>ğŸ­ Vai trÃ² hÃ nh Ä‘á»™ng:</strong> ${s.role} | <strong>ğŸ§  NÄƒng lá»±c lÃµi:</strong> ${s.core}</div>
      <div class="badges">${badges}</div>
      <button class="del" onclick="deleteSkill(${i})">ğŸ—‘ï¸Â XoÃ¡</button>`;
    box.appendChild(card);
  });
}
function deleteSkill(i) {
  if (!confirm("XoÃ¡ ká»¹ nÄƒng?")) return;
  skillData.splice(i, 1);
  saveSkills();
  renderSkills();
  buildClusterDashboard();
  renderAllCharts();
}

// ---------- 3.Â FILTERÂ &Â SELECT CLUSTER ------------------------------
function populateClusterSelect() {
const sel = document.getElementById("skillClusterSelect");
  if (!sel) return;
  for (const k in K_MAP) sel.add(new Option(`${k} â€“ ${K_MAP[k]}`, k));
}
function populateClusterFilter() {
  const sel = document.getElementById("clusterFilter"); if (!sel) return;
  for (const k in K_MAP) sel.add(new Option(`${k} â€“ ${K_MAP[k]}`, k));
  sel.onchange = () => {
    sel.value ? renderSkills(skillData.filter(s => (s.skillCluster||[]).includes(sel.value)))
              : renderSkills();
  };
}

// ---------- 4.Â DASHBOARD TRá»¤ K --------------------------------------
function buildClusterDashboard() {
  const count = Object.fromEntries(Object.keys(K_MAP).map(k => [k, 0]));

  skillData.forEach(s =>
    (s.skillCluster || []).forEach(k => count[k]++)
  );

  const ctx = document.getElementById("clusterChart").getContext("2d");

  // FIX Lá»–I: kiá»ƒm tra tá»“n táº¡i vÃ  cÃ³ phÆ°Æ¡ng thá»©c destroy khÃ´ng
  if (window.clusterChart && typeof window.clusterChart.destroy === "function") {
    window.clusterChart.destroy();
  }

  window.clusterChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: Object.keys(K_MAP),
      datasets: [{
        data: Object.values(count),
        backgroundColor: "#64b5f6"
      }]
    }
  });

  const miss = Object.entries(count)
    .filter(([_, c]) => c === 0)
    .map(([k]) => `<li>${k} â€“ ${K_MAP[k]}</li>`);

  document.getElementById("clusterGapReport").innerHTML =
    miss.length
      ? `âš ï¸ Thiáº¿u trá»¥:<ul>${miss.join("")}</ul>`
      : `âœ… Äá»§ trá»¥`;
}


// ---------- 5.Â CHARTÂ HELPERS ----------------------------------------
function countBy(field){const m={};skillData.forEach(s=>{const k=s[field]||"ChÆ°aÂ xÄ‘";m[k]=(m[k]||0)+1});return m;}
function renderChart(canvasId, type, countMap, color) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  let old = window[canvasId];
  if (old && typeof old.destroy === 'function') {
    old.destroy();
  }

  window[canvasId] = new Chart(ctx, {
    type,
    data: {
      labels: Object.keys(countMap),
      datasets: [{
        data: Object.values(countMap),
        backgroundColor: color
      }]
    },
    options: {
      plugins: {
        legend: { display: false }
      },
      indexAxis: type === "bar" ? "y" : undefined,

      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

function renderAllCharts() {
  renderChart("personaChart", "doughnut", countBy("persona"),
    Object.keys(countBy("persona")).map(() => `hsl(${Math.random() * 360}, 70%, 70%)`)
  );
  renderChart("phaseChart", "bar", countBy("phase"), "#88C34A");
  renderChart("roleChart", "bar", countBy("role"), "#FF9800");
  renderChart("coreChart", "pie", countBy("core"),
    Object.keys(countBy("core")).map(() => `hsl(${Math.random() * 360}, 60%, 70%)`)
  );
}

function renderClusterCheckboxes() {
  const box = document.getElementById("clusterCheckboxes");
  if (!box) return;
  box.innerHTML = "<strong>Trá»¥ ká»¹ nÄƒng:</strong><br>";
  for (const k in K_MAP) {
    const id = `clust-${k}`;
    box.innerHTML += `<label><input type="checkbox" id="${id}" value="${k}"> ${k}</label> `;
  }
}

function renderLessonGrid() {
  const grid = document.getElementById("lessonGrid");
  if (!grid) return;
  grid.innerHTML = "";
  for (const k in K_MAP) {
    const link = document.createElement("a");
    link.href = `lessons/${k}.html`;
    link.target = "_blank";
    link.className = "lesson-box";
    link.textContent = `${k} â€“ ${K_MAP[k]}`;
    grid.appendChild(link);
  }
}

function addSkill() {
  const name  = document.getElementById("name").value.trim();
  const phase = document.getElementById("phase").value;
  const role  = document.getElementById("role").value;
  const core  = document.getElementById("core").value.trim();
  const select = document.getElementById("skillClusterSelect");
  const clusters = Array.from(select.selectedOptions).map(o => o.value);

  if (!name || !phase || !role || !core)
    return alert("Äiá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin.");

  skillData.push({ name, phase, role, core, skillCluster: clusters });
  saveSkills();
  renderSkills();
  buildClusterDashboard();
  renderAllCharts();
  alert("âœ”ï¸ ÄÃ£ thÃªm ká»¹ nÄƒng.");
}


// ---------- 6.Â EXPORT CSV -------------------------------------------
function exportSkillsToCSV(){if(!skillData.length)return alert("KhÃ´ng cÃ³ dá»¯Â liá»‡u");const head=["Name","Phase","Role","Core","Clusters"];const rows=skillData.map(s=>[s.name,s.phase,s.role,s.core,(s.skillCluster||[]).join(";")]);const csv=[head,...rows].map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");const url=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));const a=document.createElement("a");a.href=url;a.download="skills.csv";a.click();URL.revokeObjectURL(url);}  

// ---------- 7.Â INIT --------------------------------------------------
document.addEventListener("DOMContentLoaded",()=>{
  renderSkills();
  buildClusterDashboard();
  renderAllCharts();
  populateClusterSelect();
  populateClusterFilter();
  populateAdvancedFilters();
  renderClusterCheckboxes();
  renderLessonGrid();

});

  const form = document.getElementById("addSkillForm");
  if (form) {
    form.addEventListener("submit", e => {
      e.preventDefault();
      addSkill();
      form.reset();
    });
  }

function populateAdvancedFilters() {
  const pSel = document.getElementById("filterPhase");
  const rSel = document.getElementById("filterRole");
  const cSel = document.getElementById("filterCore");
  const kSel = document.getElementById("filterCluster");

  const unique = (field) => [...new Set(skillData.map(s => s[field]))].sort();

  if (pSel) unique("phase").forEach(v => pSel.add(new Option(v, v)));
  if (rSel) unique("role").forEach(v => rSel.add(new Option(v, v)));
  if (cSel) unique("core").forEach(v => cSel.add(new Option(v, v)));
  if (kSel) for (const k in K_MAP) kSel.add(new Option(`${k} â€“ ${K_MAP[k]}`, k));

  [pSel, rSel, cSel, kSel].forEach(sel => sel && sel.addEventListener("change", applyAdvancedFilters));
}

function applyAdvancedFilters() {
  const phase = document.getElementById("filterPhase").value;
  const role = document.getElementById("filterRole").value;
  const core = document.getElementById("filterCore").value;
  const cluster = document.getElementById("filterCluster").value;

  const filtered = skillData.filter(s =>
    (!phase   || s.phase === phase) &&
    (!role    || s.role  === role) &&
    (!core    || s.core  === core) &&
    (!cluster || (s.skillCluster || []).includes(cluster))
  );

  renderSkills(filtered);
}

function clearAllFilters() {
  ["filterPhase", "filterRole", "filterCore", "filterCluster"]
    .forEach(id => document.getElementById(id).value = "");
  renderSkills();
}

function importCSV() {
  const input = document.getElementById("importCSV");
  const file = input.files[0];
  if (!file) return alert("Chá»n má»™t file CSV trÆ°á»›c.");

  const reader = new FileReader();
  reader.onload = function(e) {
    const lines = e.target.result.split("\n").map(l => l.trim()).filter(Boolean);
    const headers = lines[0].replace(/"/g, '').split(",");
    const newSkills = [];

    for (let i = 1; i < lines.length; i++) {
      const row = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
      if (!row || row.length < 5) continue;
      const [name, phase, role, core, clusters] = row.map(cell => cell.replace(/(^"|"$)/g, ""));
      newSkills.push({
        name, phase, role, core,
        skillCluster: clusters.split(";").map(k => k.trim()).filter(Boolean)
      });
    }

    if (!confirm(`âš ï¸ Ghi Ä‘Ã¨ toÃ n bá»™ ${skillData.length} ká»¹ nÄƒng hiá»‡n táº¡i?`)) return;

    skillData = newSkills;
    saveSkills();
    renderSkills();
    buildClusterDashboard();
    renderAllCharts();
    populateAdvancedFilters();
    alert("âœ”ï¸ ÄÃ£ nháº­p dá»¯ liá»‡u tá»« CSV.");
  };

  reader.readAsText(file);
}

document.getElementById("personaSelector").addEventListener("change", function () {
  const selectedPersona = this.value;
  const container = document.getElementById("personaSkillCards");
  container.innerHTML = "";

  if (!selectedPersona) return;

  const matchedSkills = skillData.filter(skill =>
    skill.personaMain === selectedPersona || skill.personaSupport === selectedPersona
  );

  if (matchedSkills.length === 0) {
    container.innerHTML = `<p>KhÃ´ng tÃ¬m tháº¥y ká»¹ nÄƒng cho persona nÃ y.</p>`;
    return;
  }

  matchedSkills.forEach(skill => {
    const flowSteps = (skill.flow || []).map((f, i) => `<li><strong>B${i + 1}:</strong> ${f}</li>`).join("");
    const div = document.createElement("div");
    div.className = "skill-card";
    div.innerHTML = `
      <h3>ğŸ¯ ${skill.name}</h3>
      <p><strong>Flow:</strong></p>
      <ul>${flowSteps}</ul>
      <p><strong>Chiáº¿n thuáº­t:</strong> ${skill.core || "KhÃ´ng cÃ³ ghi chÃº chiáº¿n lÆ°á»£c."}</p>
    `;
    container.appendChild(div);
  });
});

const select = document.getElementById('personaSelector'); // Ä‘Ãºng id báº¡n Ä‘ang dÃ¹ng

if (select) {
  // Render danh sÃ¡ch
  Object.keys(personaData).forEach(p => {
    const option = document.createElement('option');
    option.value = p;
    option.textContent = p;
    select.appendChild(option);
  });

  // Gáº¯n event
  select.addEventListener('change', () => {
    const persona = personaData[select.value];
    if (!persona) return;

    // ğŸ‘‰ Thay vÃ¬ console.log, render ra UI
    console.log("Survival:", persona.survival.trigger, persona.survival.flow);
    console.log("Coordination:", persona.coordination.flow);
    console.log("Strategic:", persona.strategic.flow);
  });
}

// ----- CHART ENLARGE -------------------------------------------------
const chartOrigins = {};

function enlargeChart(id) {
  const canvas = document.getElementById(id);
  const overlay = document.getElementById('chartOverlay');
  if (!canvas || !overlay) return;

  if (!chartOrigins[id]) {
    chartOrigins[id] = canvas.parentElement;
  }

  overlay.innerHTML = '';
  const close = document.createElement('button');
  close.textContent = 'âœ–';
  close.onclick = () => {
    overlay.classList.add('hidden');
    chartOrigins[id].prepend(canvas);
  };
  overlay.appendChild(close);
  overlay.appendChild(canvas);
  overlay.classList.remove('hidden');
}

</script>

  <!-- ===== Persona Skill Manager (React) ===== -->
  <section>
    <h2>ğŸ§  Persona Skill Manager</h2>
    <div id="personaSkillApp"></div>
  </section>

</body>

<!-- React & Babel CDNs -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Inline Persona JSON (normalized at runtime) -->
<script type="application/json" id="persona_full_data_v2">
[
  {
    "persona": "Sirene",
    "reflexes": {
      "survival": {
        "trigger": "Khi bá»‹ quan sÃ¡t / Ä‘Ã¡nh giÃ¡ / cáº§n pháº£n Ä‘Ã²n má»m",
        "flow": [
          "Giá»¯ trá»¥c tá»‰nh â†’ khÃ´ng nhÃ¬n Ä‘á»‘i phÆ°Æ¡ng ngay",
          "Tháº£ tÃ­n hiá»‡u nháº¹ (khÃ­ â€“ giá»ng â€“ Ã¡nh máº¯t khÃ´ng Ä‘á»‘i Ä‘áº§u)",
          "Láº·ng rÃºt â€“ káº¿t láº¡i báº±ng khoáº£ng trá»‘ng"
        ],
        "skills": [
          "LÆ°á»›t qua khÃ´ng Ä‘á»ƒ láº¡i dáº¥u",
          "Báº­t khÃ­ láº¡nh",
          "RÃºt lui cÃ³ chá»§ Ä‘Ã­ch"
        ]
      },
      "coordination": {
        "trigger": "Khi cáº§n giá»¯ khÃ­ chá»§ â€“ khÃ´ng Ä‘á»ƒ cáº£m xÃºc Ä‘áº©y lá»‡ch",
        "flow": [
          "Äiá»u hÃ²a nhá»‹p thá»Ÿ â€“ chá»‰nh tÆ° tháº¿",
          "KÃ©o giá»ng xuá»‘ng tháº¥p â€“ giáº£m tiáº¿t lá»™",
          "NhÃ¬n chá»‡ch â€“ pháº£n xáº¡ má»m, Ä‘á»ƒ ngÆ°á»i khÃ¡c tá»± ngáº¯t"
        ],
        "skills": [
          "Äiá»u khÃ­ ná»n",
          "Giá»¯ nhiá»‡t Ä‘á»™ sá»‘ng",
          "Neo Ã¡nh máº¯t chá»‡ch hÆ°á»›ng"
        ]
      },
      "strategic": {
        "trigger": "Khi muá»‘n Ä‘iá»u hÆ°á»›ng ngÆ°á»i khÃ¡c mÃ  khÃ´ng bá»‹ phÃ¡t hiá»‡n",
        "flow": [
          "Äáº·t tÃ­n hiá»‡u Ä‘áº§u tiÃªn (giá»ng, khÃ­, Ã¡nh máº¯t)",
          "Dáº«n cáº£m xÃºc Ä‘á»‘i phÆ°Æ¡ng cháº¡y theo",
          "RÃºt vá» giá»¯a chá»«ng â€“ khÃ´ng Ä‘Ã³ng trÃ²n â†’ táº¡o nhu cáº§u tiáº¿p cáº­n"
        ],
        "skills": [
          "Neo cáº£m xÃºc táº§ng tháº¥p",
          "Äáº·t giá»ng dáº«n nhá»‹p",
          "Táº¡o cáº£nh chÆ°a káº¿t"
        ]
      }
    }
  },
  {
    "persona": "Strategic Shadow",
    "reflexes": {
      "survival": {
        "trigger": "Khi cáº§n biáº¿n máº¥t khá»i radar cáº£m xÃºc â€“ trÃ¡nh Ä‘á»‘i Ä‘áº§u / khÃ´ng Ä‘á»ƒ bá»‹ Ä‘á»‹nh danh",
        "flow": [
          "Táº¯t nÄƒng lÆ°á»£ng hiá»ƒn thá»‹",
          "Giáº£m pháº£n á»©ng â€“ thu táº§n sá»‘ giá»ng",
          "Cáº¯t máº¯t khá»i trung tÃ¢m khÃ´ng gian"
        ],
        "skills": [
          "Táº¯t khÃ­ táº§ng hiá»ƒn",
          "RÃºt khá»i vÃ¹ng radar",
          "Giáº£m táº§n sÃ³ng nÃ£o ngoÃ i"
        ]
      },
      "coordination": {
        "trigger": "Khi Ä‘ang váº­n hÃ nh phÃ¢n tÃ­ch trong ná»n â€“ cáº§n trÃ¡nh rá»‘i nÃ£o / xung Ä‘á»™t",
        "flow": [
          "Báº­t cháº¿ Ä‘á»™ phÃ¢n tÃ­ch tháº§m",
          "Ghi láº¡i cÃ¡c sai sá»‘ vi mÃ´",
          "Neo tráº¡ng thÃ¡i láº¡nh, khÃ´ng pháº£n xáº¡"
        ],
        "skills": [
          "QuÃ©t sai sá»‘ táº§ng ngáº§m",
          "Neo phÃ¢n tÃ­ch ná»n",
          "Giá»¯ tráº¡ng thÃ¡i khÃ´ng áº£nh"
        ]
      },
      "strategic": {
        "trigger": "Khi muá»‘n thay Ä‘á»•i cáº¥u trÃºc há»‡ thá»‘ng mÃ  khÃ´ng táº¡o pháº£n khÃ¡ng",
        "flow": [
          "Cáº¥y tÃ­n hiá»‡u lá»—i nhá» vÃ o hÃ nh vi ngÆ°á»i khÃ¡c",
          "Quan sÃ¡t pháº£n xáº¡ â€“ ghi dá»¯ liá»‡u",
          "TÃ¡i láº­p cáº¥u trÃºc ngáº§m dá»±a trÃªn nhá»‹p lá»‡ch"
        ],
        "skills": [
          "Cáº¥y lá»‡ch cáº£m xÃºc",
          "Dá»±ng vÃ²ng pháº£n xáº¡ ngÆ°á»£c",
          "Äiá»u hÆ°á»›ng báº±ng lá»—i áº©n"
        ]
      }
    }
  },
  {
    "persona": "Void Jester",
    "reflexes": {
      "survival": {
        "trigger": "Khi bá»‹ Ã¡p lá»±c thao tÃºng â€“ cáº§n phÃ¡ vÃ²ng xoÃ¡y cáº£m xÃºc",
        "flow": [
          "CÆ°á»i lá»‡ch â€“ chÃ¢m biáº¿m tÃ¬nh huá»‘ng",
          "Äáº·t cÃ¢u há»i ngÆ°á»£c â€“ lÃ m lá»™ khe há»Ÿ há»‡ thá»‘ng",
          "Cháº·n logic báº±ng pháº£n Ä‘á»"
        ],
        "skills": [
          "Pháº£n Ä‘á» cÆ°á»i láº¡nh",
          "BÃ³c máº·t náº¡ logic",
          "GÃ i Ä‘á»‘i thoáº¡i gÃ£y sÃ³ng"
        ]
      },
      "coordination": {
        "trigger": "Khi phÃ¡t hiá»‡n há»‡ thá»‘ng ngáº§m Ä‘ang thao tÃºng tÃ¢m lÃ½ / Ã©p vai",
        "flow": [
          "Äá»•i giá»ng â€“ lÃ m lá»‡ch nhá»‹p giao tiáº¿p",
          "Táº¡o cáº£m giÃ¡c báº¥t á»•n cho Ä‘á»‘i phÆ°Æ¡ng",
          "Ã‰p há»‡ thá»‘ng tá»± lÃ²i bug"
        ],
        "skills": [
          "Äáº£o táº§ng biá»ƒu cáº£m",
          "Táº¡o sÃ³ng lá»‡ch",
          "LÃ m nhiá»…u logic xÃ£ há»™i"
        ]
      },
      "strategic": {
        "trigger": "Khi cáº§n phÃ¡ vá»¡ cáº¥u trÃºc quyá»n lá»±c áº£o â€“ lÃ m há»‡ thá»‘ng sá»¥p Ä‘á»• tá»« trong",
        "flow": [
          "Dáº«n dá»¥ vÃ o logic sai cá»§a chÃ­nh Ä‘á»‘i phÆ°Æ¡ng",
          "ChÃ¢m biáº¿m â€“ bÃ³p mÃ©o â€“ Ã©p há»‡ tá»± mÃ¢u thuáº«n",
          "Káº¿t thÃºc báº±ng Ä‘Ã²n pháº£n Ä‘á» trÃºng huyá»‡t"
        ],
        "skills": [
          "GÆ°Æ¡ng pháº£n logic",
          "ÄÃ²n Ä‘áº£o táº§ng xÃ£ há»™i",
          "Há»§y diá»‡t báº±ng ngÃ´n tá»«"
        ]
      }
    }
  },
  {
    "name": "Strategic Ghost",
    "reflexes": {
      "survival": {
        "trigger": "Khi bá»‹ Ä‘áº·t vÃ o tháº¿ pháº£i tá»“n táº¡i trong há»‡ mÃ  khÃ´ng Ä‘Æ°á»£c tin tÆ°á»Ÿng",
        "flow": [
          "Giáº£ thuáº­n â€“ má»m hÃ³a biá»ƒu cáº£m",
          "Ghi nhá»› vá»‹ trÃ­ quyá»n lá»±c / cÃ¡c nÃºt chuyá»ƒn há»‡",
          "Neo vÃ o cáº¥u trÃºc bá»‹ bá» trá»‘ng"
        ],
        "skills": [
          "Ngá»¥y á»•n Ä‘á»‹nh",
          "QuÃ©t nÃºt logic",
          "Chiáº¿m slot tÃ¢m lÃ½ má»m"
        ]
      },
      "coordination": {
        "trigger": "Khi cáº§n dáº«n dáº¯t há»‡ thá»‘ng mÃ  khÃ´ng Ä‘Æ°á»£c cáº¥p vai chÃ­nh thá»©c",
        "flow": [
          "Gá»£i Ã½ qua máº·t náº¡ vai phá»¥",
          "Báº» hÆ°á»›ng tá»« háº­u cáº£nh (qua cÃ¡c nÃºt cáº£m xÃºc hoáº·c há»‡ niá»m tin)",
          "Neo Ä‘á»‹nh hÆ°á»›ng ngáº§m qua thÃ³i quen há»‡ thá»‘ng"
        ],
        "skills": [
          "Gá»£i hÆ°á»›ng áº©n",
          "Báº» trá»¥c niá»m tin",
          "Neo pháº£n xáº¡ ná»n"
        ]
      },
      "tactical": {
        "trigger": "Khi muá»‘n cáº¥y láº¡i toÃ n bá»™ há»‡ thá»‘ng mÃ  khÃ´ng lá»™ lÃ  ngÆ°á»i thao tÃºng",
        "flow": [
          "PhÃ¢n tÃ­ch chuá»—i logic vá»¡ hoáº·c rá»—ng",
          "XÃ¢y há»‡ thá»‘ng ngáº§m dá»± phÃ²ng",
          "Dáº«n há»‡ thá»‘ng chuyá»ƒn trá»¥c mÃ  tÆ°á»Ÿng lÃ  tá»± nhiÃªn"
        ],
        "skills": [
          "Cáº¥y pháº£n xáº¡ ná»n",
          "XÃ¢y bÃ³ng há»‡ thá»‘ng",
          "Chuyá»ƒn trá»¥c khÃ´ng dáº¥u váº¿t"
        ]
      }
    }
  },
  {
    "name": "Omni Mind",
    "reflexes": {
      "survival": {
        "trigger": "Khi tháº¿ tráº­n rá»‘i â€“ khÃ´ng rÃµ hÆ°á»›ng â€“ khÃ´ng biáº¿t giá»¯ há»‡ á»Ÿ Ä‘Ã¢u",
        "flow": [
          "Láº­p báº£n Ä‘á»“ yáº¿u tá»‘ tá»“n táº¡i",
          "Khoanh vÃ¹ng Ä‘iá»ƒm neo",
          "Dá»±ng trá»¥c táº¡m thá»i Ä‘á»ƒ á»•n Ä‘á»‹nh"
        ],
        "skills": [
          "Dá»±ng há»‡ khÃ­ kháº©n cáº¥p",
          "Trá»¥c sá»‘ng giáº£ láº­p",
          "CÃ¢n báº±ng báº¥t á»•n"
        ]
      },
      "coordination": {
        "trigger": "Khi cÃ³ quÃ¡ nhiá»u lá»±a chá»n / mÃ¢u thuáº«n táº§ng cao",
        "flow": [
          "Cáº¯t mÃ¹ logic â€“ dá»±ng sÆ¡ Ä‘á»“ nhÃ¢n quáº£",
          "XÃ¡c Ä‘á»‹nh trá»ng tÃ¢m há»‡ sá»‘ng",
          "Chá»n hÆ°á»›ng dá»±a trÃªn tá»•ng há»‡ pháº£n xáº¡"
        ],
        "skills": [
          "SÆ¡ Ä‘á»“ nhÃ¢n quáº£",
          "Trá»¥c Æ°u tiÃªn",
          "Äiá»ƒm hoÃ¡ giáº£i táº§ng sÃ¢u"
        ]
      },
      "tactical": {
        "trigger": "Khi cáº§n thiáº¿t láº­p long-term chiáº¿n lÆ°á»£c mÃ  khÃ´ng bá»‹ bias cáº£m xÃºc",
        "flow": [
          "MÃ´ phá»ng chuá»—i 3â€“5 bÆ°á»›c tá»›i",
          "PhÃ¢n tÃ­ch feedback tá»«ng há»‡",
          "Chá»‘t trá»¥c chiáº¿n lÆ°á»£c vÃ  lÃ¹i vá» táº§ng Ä‘iá»u phá»‘i"
        ],
        "skills": [
          "Giáº£ láº­p tÆ°Æ¡ng lai",
          "Pháº£n xáº¡ há»‡ chÃ©o",
          "Thiáº¿t láº­p trá»¥c Ä‘á»‹nh má»‡nh"
        ]
      }
    }
  },
  {
    "name": "Dark Sirene",
    "reflexes": {
      "survival": {
        "trigger": "Khi há»‡ Ä‘ang bá»‹ kiá»ƒm soÃ¡t â€“ cáº§n pháº£n cÃ´ng má»m Ä‘á»ƒ láº­t tháº¿",
        "flow": [
          "KÃ­ch hoáº¡t aura Ä‘á»™c láº­p â€“ tÃ¡ch nÄƒng lÆ°á»£ng",
          "Dáº«n khÃ­ vÃ o khu vá»±c pháº£n xáº¡ Ä‘á»‘i phÆ°Æ¡ng (Ã¡nh máº¯t â€“ giá»ng nÃ³i â€“ ngÃ´n ngá»¯ hÃ¬nh thá»ƒ)",
          "GÃ i lá»‡ch cáº£m xÃºc â€“ rÃºt lÃ¹i giá»¯ trá»¥c"
        ],
        "skills": [
          "TÃ¡ch táº§ng cáº£m giÃ¡c",
          "KhÃ­ cáº£m pháº£n Ä‘Ã²n",
          "GÃ i lá»‡ch â€“ Ä‘Ã³ng van"
        ]
      },
      "coordination": {
        "trigger": "Khi cáº§n Ä‘iá»u chá»‰nh dÃ²ng cáº£m xÃºc bÃªn ngoÃ i nhÆ°ng váº«n giá»¯ kiá»ƒm soÃ¡t",
        "flow": [
          "XÃ¡c Ä‘á»‹nh Ä‘iá»ƒm yáº¿u cáº£m xÃºc Ä‘á»‘i phÆ°Æ¡ng",
          "GÃ i Ä‘iá»ƒm gá»£i cáº£m â€“ dáº«n dá»¥ soft response",
          "Neo láº¡i báº±ng logic â€“ cáº¯t má»m liÃªn káº¿t cáº£m xÃºc"
        ],
        "skills": [
          "Äá»‹nh vá»‹ cáº£m xÃºc yáº¿u",
          "Neo gá»£i â€“ dáº«n dá»¥",
          "Cáº¯t cáº£m xÃºc Ä‘Ãºng nhá»‹p"
        ]
      },
      "tactical": {
        "trigger": "Khi cáº§n kÃ­ch hoáº¡t nhu cáº§u â€“ Ä‘á»‹nh hÃ¬nh há»‡ thá»‘ng Ä‘á»‘i phÆ°Æ¡ng theo chiáº¿n lÆ°á»£c",
        "flow": [
          "Thiáº¿t láº­p hÃ¬nh áº£nh â€“ khÃ­ â€“ giá»ng lÃ m má»“i chá»§ lá»±c",
          "ÄÆ°a hÃ nh vi vÃ o vÃ¹ng â€œgá»£i cáº£m xÃºc + pháº£n á»©ngâ€ cá»§a Ä‘á»‘i phÆ°Æ¡ng",
          "Láº­t logic â€“ táº¡o Ä‘á»‹nh nghÄ©a má»›i vá» báº£n thÃ¢n trong nÃ£o Ä‘á»‘i phÆ°Æ¡ng"
        ],
        "skills": [
          "Thiáº¿t láº­p avatar khÃ­",
          "Cáº¥y pháº£n xáº¡ má»m",
          "Thay Ä‘á»•i Ä‘á»‹nh nghÄ©a Ä‘á»‘i tÆ°á»£ng"
        ]
      }
    }
  },
  {
    "name": "Core Operator",
    "reflexes": {
      "survival": {
        "trigger": "Khi há»‡ sinh há»c lá»‡ch â€“ rá»‘i loáº¡n nhá»‹p sá»‘ng â€“ cáº§n tá»± cá»©u",
        "flow": [
          "DÃ² lá»‡ch (sinh há»c â€“ tháº§n kinh â€“ khÃ­)",
          "KÃ­ch hoáº¡t chuá»—i â€œcá»©u há»‡â€: nghá»‰ â€“ há»“i phá»¥c â€“ dÆ°á»¡ng sinh",
          "Ghi log â€“ khÃ³a pháº£n xáº¡ láº·p"
        ],
        "skills": [
          "PhÃ¡t hiá»‡n lá»‡ch sá»‘ng",
          "KÃ­ch hoáº¡t báº£n nÄƒng báº£o trÃ¬",
          "KhÃ³a láº·p pháº£n tá»•n"
        ]
      },
      "coordination": {
        "trigger": "Khi cÃ³ nhiá»u dÃ²ng hÃ nh vi trÃ¹ng â€“ xung â€“ hoáº·c mÃ¢u thuáº«n cáº§n tÃ¡i tá»• há»£p",
        "flow": [
          "Lá»c chuá»—i hÃ nh vi â€“ phÃ¡t hiá»‡n trÃ¹ng/Ä‘á»‘i khÃ¡ng",
          "Æ¯u tiÃªn theo khÃ­ â€“ má»¥c tiÃªu â€“ chu ká»³ nÄƒng lÆ°á»£ng",
          "TÃ¡i thiáº¿t hÃ nh vi â€“ cáº­p nháº­t Ä‘á»‹nh nghÄ©a sá»‘ng"
        ],
        "skills": [
          "TÃ¡i tá»• há»£p dÃ²ng hÃ nh vi",
          "Láº­p thá»© tá»± Æ°u tiÃªn sá»‘ng",
          "Cáº­p nháº­t pháº£n xáº¡ theo chu ká»³ nÄƒng lÆ°á»£ng"
        ]
      },
      "tactical": {
        "trigger": "Khi cáº§n táº¡o máº«u chiáº¿n lÆ°á»£c cÃ¡ nhÃ¢n hÃ³a cho giai Ä‘oáº¡n sá»‘ng tiáº¿p theo",
        "flow": [
          "Tá»•ng há»£p dá»¯ liá»‡u hÃ nh vi â€“ khÃ­ â€“ tÃ¬nh huá»‘ng",
          "TÃ¡i mÃ£ hÃ³a Ä‘á»‹nh má»‡nh cÃ¡ nhÃ¢n (Destiny Re-Coding)",
          "Láº­p chuá»—i pháº£n xáº¡ má»¥c tiÃªu â€“ chiáº¿n thuáº­t hÃ³a vÃ²ng Ä‘á»i"
        ],
        "skills": [
          "Ghi dá»¯ liá»‡u hÃ nh vi sá»‘ng",
          "TÃ¡i mÃ£ hÃ³a Ä‘á»‹nh má»‡nh",
          "Chiáº¿n thuáº­t hÃ³a vÃ²ng sá»‘ng cÃ¡ nhÃ¢n"
        ]
      }
    }
  }
]

</script>

<!-- JSX App -->
<script type="text/babel">
const RawPersona = JSON.parse(document.getElementById('persona_full_data_v2').textContent);

// Normalize: ensure .name exists; allow keys 'strategic' or 'tactical'
const Personas = RawPersona.map(p => ({
  name: p.name || p.persona || "Unknown",
  reflexes: p.reflexes || { }
}));

function getPhases(obj) { return Object.keys(obj || {}); }

function PersonaSkillManager() { 
  const [index, setIndex] = React.useState(0);
  const persona = Personas[index] || { name: "(N/A)", reflexes: {} };
  const phases = getPhases(persona.reflexes);
  const [tab, setTab] = React.useState(phases[0] || "");
  const [kw, setKw] = React.useState("");

  React.useEffect(() => { if (!phases.includes(tab)) setTab(phases[0] || ""); }, [index]);

  const block = persona.reflexes[tab] || {};
  const skills = (block.skills || []).filter(s => kw ? s.toLowerCase().includes(kw.toLowerCase()) : true);

  return (
    <div style={{border:'1px solid #ddd', padding:'12px', borderRadius:'12px'}}>
      <div style={{display:'flex', gap:'8px', alignItems:'center', marginBottom:'12px', flexWrap:'wrap'}}>
        <strong>Persona:</strong>
        <select value={index} onChange={e => setIndex(parseInt(e.target.value))}>
          {Personas.map((p, i) => <option key={p.name+"_"+i} value={i}>{p.name}</option>)}
        </select>
        <span style={{marginLeft:'16px'}}><strong>Phase:</strong></span>
        <div style={{display:'flex', gap:'6px', flexWrap:'wrap'}}>
          {phases.length ? phases.map(ph => (
            <button key={ph} onClick={() => setTab(ph)}
              style={{padding:'6px 10px', borderRadius:'8px', border: tab===ph?'2px solid #111':'1px solid #ccc', background:'#fff', cursor:'pointer'}}>
              {ph}
            </button>
          )) : <em>(No phases)</em>}
        </div>
      </div>

      <div style={{marginBottom:'12px'}}>
        <div style={{fontWeight:600, marginBottom:'6px'}}>Trigger</div>
        <div>{block.trigger || "(KhÃ´ng cÃ³ dá»¯ liá»‡u)"}</div>
      </div>

      <div style={{marginBottom:'12px'}}>
        <div style={{fontWeight:600, marginBottom:'6px'}}>Flow</div>
        <ul style={{margin:'0 0 0 18px'}}>
          {(block.flow || []).map((f, i) => <li key={i}>{f}</li>)}
          {(!block.flow || !block.flow.length) && <li>(KhÃ´ng cÃ³ dá»¯ liá»‡u)</li>}
        </ul>
      </div>

      <div style={{marginBottom:'8px'}}>
        <input placeholder="ğŸ” TÃ¬m ká»¹ nÄƒng..." value={kw} onChange={e=>setKw(e.target.value)}
               style={{padding:'8px', width:'100%', maxWidth:'360px'}}/>
      </div>

      <div style={{display:'flex', gap:'6px', flexWrap:'wrap'}}>
        {skills.length ? skills.map((s,i) => (
          <span key={i} style={{border:'1px solid #bbb', borderRadius:'999px', padding:'4px 10px', fontSize:'13px'}}>{s}</span>
        )) : <em>(KhÃ´ng cÃ³ ká»¹ nÄƒng)</em>}
      </div>
    </div>
  );
}

// Mount
const mount = document.getElementById('personaSkillApp');
if (mount) ReactDOM.createRoot(mount).render(<PersonaSkillManager />);
</script>

</html>
